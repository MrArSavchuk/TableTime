# 📄 README (informational, for the repository file)

## TableTime — table reservation demo (React + Vite + MSW)

A realistic, accessible booking flow with a searchable restaurant input, date/time pickers with keyboard support, availability lookup, booking confirmation (with .ics + Google Calendar), and a “Manage bookings” area (search, cancel, reschedule). All backend endpoints are mocked with **Mock Service Worker (MSW)**.

---

## ✨ Features

- **Booking form**
  - Type-ahead **restaurant search** with keyboard navigation.
  - **Strict MM/DD/YYYY** date masking + hidden native date picker.
  - **Time popover** that shows only **available slots** for the selected date & restaurant.
  - Live **availability** (mock) for 17:00–22:00 at 30-min steps.
  - **Client-side validation** (React Hook Form) with friendly errors.
  - **Remember my details** toggle (localStorage).
  - Confirmation screen with:
    - **.ics** file download
    - **Add to Google Calendar** link
    - **Copy code** and **Print**
- **Manage bookings**
  - Search by **email** (and optional date).
  - **Cancel** an existing booking.
  - **Reschedule** with availability check & conflict handling.
- **Dark/Light theme** with a theme toggle (persisted).
- **MSW backend**
  - `/api/restaurants`, `/api/availability`, `/api/bookings` (list/create),
    `/api/bookings/:code` (delete/patch)
  - In-memory data store; resets on dev server restart.

---

## 🧱 Tech stack

- React 18, Vite
- React Hook Form
- MSW (Mock Service Worker)
- Vanilla CSS (theme tokens), accessible HTML

---

## 🚀 Getting started

```bash
npm install
npm run dev
```

Visit http://localhost:5173

### Build & preview

```bash
npm run build
npm run preview
```

> **MSW in dev only**  
> The mock worker is started only when `import.meta.env.DEV` is true. Production builds don’t automatically enable mocks.

---

## 🗂 Project structure

```
public/
  back_day.jpg
  back_night.jpg
  restaurant-favicon.ico
  site.webmanifest
  mockServiceWorker.js      # auto-generated by MSW (do not edit)

src/
  assets/                   # UI icons for date/time addons
    icon_cal_d.png
    icon_cal_l.png
    icon_cloc_d.png
    icon_cloc_l.png
  components/
    BookingForm.jsx
    ManageBooking.jsx
    ThemeToggle.jsx
  hooks/
    useTheme.js
  mocks/
    browser.js              # starts MSW in dev
    handlers.js             # all mock endpoints
  styles/
    themes.css              # (optional per-project split)
  App.jsx
  main.jsx
  styles.css                # global styles & tokens
```

---

## 🧪 Mock API (MSW)

### `GET /api/restaurants`
Returns array `{ id, name }`.  
IDs are slugs (e.g., `"la-piazza"`).

### `GET /api/availability?restaurant=<id>&date=<YYYY-MM-DD>`
Returns:
```json
{ "slots": ["17:00", "17:30", "..."], "capacityPerSlot": 10 }
```

### `POST /api/bookings`
Body:
```json
{
  "restaurant": "la-piazza",
  "date": "2025-09-17",
  "time": "18:30",
  "guests": 2,
  "name": "John Doe",
  "email": "john@example.com",
  "note": ""
}
```
Responses:
- **201** created → booking object with `code` (e.g., `"TT-8K2PZ"`).
- **409** conflict if the slot is already taken.
- **400** missing fields.
- **500** small random chance to simulate server errors.

### `GET /api/bookings?email=<email>&date=<YYYY-MM-DD>`
List bookings (filters optional).

### `DELETE /api/bookings/:code`
Cancels a booking. Returns **204**.

### `PATCH /api/bookings/:code`
Body: `{ "date": "YYYY-MM-DD", "time": "HH:mm" }`  
Returns updated booking or **409** on conflict.

---

## 🔧 MSW initialization

**`src/mocks/browser.js`**
```js
import { setupWorker } from 'msw/browser';
import { handlers } from './handlers';

export const worker = setupWorker(...handlers);
```

**`src/main.jsx`** (excerpt)
```js
async function enableMocking() {
  if (!import.meta.env.DEV) return;
  const { worker } = await import('./mocks/browser');
  await worker.start({ serviceWorker: { url: '/mockServiceWorker.js' } });
}
await enableMocking();
```

> If you change handlers and see stale responses, hard-reload with **Disable cache** in DevTools (or clear SW).

---

## 🧩 Accessibility

- Labels linked to inputs
- Keyboard navigation for suggestions & time popover
- Clear error messages and state hints
- High contrast themes

---

## 🎨 Theming & assets

- Theme tokens in `styles.css` under `:root` and `:root[data-theme="dark"]`.
- Backgrounds in `public/back_day.jpg` & `public/back_night.jpg`.
- Favicon in `public/restaurant-favicon.ico`.

---

## 🛣 Roadmap ideas

- Real backend & persistence
- Authenticated “My bookings”
- i18n + date/number formats
- More granular capacity rules

---

## ⚠️ Known pitfalls

- If you see “ServiceWorker… unsupported MIME type”, ensure the SW URL is `/mockServiceWorker.js` and the file exists in **public/**.
- If manifest errors appear, ensure `site.webmanifest` is valid JSON and linked as:
  ```html
  <link rel="manifest" href="/site.webmanifest" type="application/manifest+json" />
  ```
